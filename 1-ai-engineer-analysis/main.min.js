function throttle(t,e=16){let o=0,n=null;return function(...s){const i=Date.now(),a=e-(i-o);a<=0?(n&&(clearTimeout(n),n=null),o=i,t.apply(this,s)):n||(n=setTimeout(()=>{o=Date.now(),n=null,t.apply(this,s)},a))}}let cachedNodes=null,cachedConnections=null;function getNodes(){return cachedNodes||(cachedNodes=document.querySelectorAll(".graph-node")),cachedNodes}function getConnections(){return cachedConnections||(cachedConnections=document.querySelectorAll(".graph-connection")),cachedConnections}function clearCache(){cachedNodes=null,cachedConnections=null}let currentHighlightedId=null;function highlightRelated(t){const e=getNodes(),o=getConnections();if(0===e.length)return;const n=new Set([t]);o.forEach(e=>{const o=e.getAttribute("data-from"),s=e.getAttribute("data-to");o===t&&n.add(s),s===t&&n.add(o)});const s=new Set(n);o.forEach(t=>{const e=t.getAttribute("data-from"),o=t.getAttribute("data-to");n.has(e)&&s.add(o),n.has(o)&&s.add(e)}),requestAnimationFrame(()=>{e.forEach(t=>{const e=t.getAttribute("data-id");s.has(e)?(t.classList.remove("dimmed"),t.classList.add("highlighted")):(t.classList.remove("highlighted"),t.classList.add("dimmed"))}),o.forEach(t=>{const e=t.getAttribute("data-from"),o=t.getAttribute("data-to");s.has(e)&&s.has(o)?(t.classList.remove("dimmed"),t.classList.add("highlighted")):(t.classList.remove("highlighted"),t.classList.add("dimmed"))})}),currentHighlightedId=t}function resetHighlight(){const t=getNodes(),e=getConnections();requestAnimationFrame(()=>{t.forEach(t=>{t.classList.remove("dimmed","highlighted")}),e.forEach(t=>{t.classList.remove("dimmed","highlighted")})}),currentHighlightedId=null}const collapsedNodes=new Set;function toggleCollapse(t,e){if(collapsedNodes.has(t)){collapsedNodes.delete(t),expandChildren(t);const o=e.querySelector(".collapse-icon");o&&(o.textContent="âˆ’")}else{collapsedNodes.add(t),collapseChildren(t);const o=e.querySelector(".collapse-icon");o&&(o.textContent="+")}}function collapseChildren(t){const e=getNodes(),o=getConnections(),n=getDescendantIds(t);requestAnimationFrame(()=>{e.forEach(t=>{const e=t.getAttribute("data-id");n.has(e)&&(t.style.display="none")}),o.forEach(e=>{const o=e.getAttribute("data-from"),s=e.getAttribute("data-to");(n.has(o)||n.has(s)||o===t)&&(e.style.display="none")})})}function expandChildren(t){const e=getNodes(),o=getConnections(),n=getDescendantIds(t);requestAnimationFrame(()=>{e.forEach(t=>{const e=t.getAttribute("data-id");t.getAttribute("data-parent");n.has(e)&&(hasCollapsedAncestor(e)||(t.style.display=""))}),o.forEach(e=>{const o=e.getAttribute("data-from"),s=e.getAttribute("data-to");(n.has(o)||n.has(s)||o===t)&&(hasCollapsedAncestor(o)||hasCollapsedAncestor(s)||(e.style.display=""))})})}function getDescendantIds(t){getNodes();const e=getConnections(),o=new Set,n=[t];for(;n.length>0;){const t=n.pop();e.forEach(e=>{const s=e.getAttribute("data-from"),i=e.getAttribute("data-to");s!==t||o.has(i)||(o.add(i),n.push(i))})}return o}function hasCollapsedAncestor(t){const e=getNodes(),o=Array.from(e).find(e=>e.getAttribute("data-id")===t);if(!o)return!1;let n=o.getAttribute("data-parent");for(;n;){if(collapsedNodes.has(n))return!0;const t=Array.from(e).find(t=>t.getAttribute("data-id")===n);if(!t)break;n=t.getAttribute("data-parent")}return!1}const tooltip=document.getElementById("tooltip");function getTaskDetails(t){const{taskData:e}=window.graphData||{};if(!e)return null;for(const o of Object.values(e))for(const[e,n]of Object.entries(o.subcategories)){const s=n.tasks.find(e=>e.id===t);if(s)return{...s,scene:o.name,subcat:e}}return null}function getSubcatDetails(t){const{taskData:e}=window.graphData||{};if(!e)return null;for(const o of Object.values(e))for(const[e,n]of Object.entries(o.subcategories))if(n.id===t)return{name:e,scene:o.name,timePercent:n.timePercent,taskCount:n.tasks.length};return null}function getSceneDetails(t){const{taskData:e}=window.graphData||{};if(!e)return null;for(const o of Object.values(e))if(o.id===t){const t=Object.keys(o.subcategories).length;let e=0;return Object.values(o.subcategories).forEach(t=>{e+=t.tasks.length}),{name:o.name,timePercent:o.timePercent,subcatCount:t,taskCount:e}}return null}function getAgentDetails(t){const{agentData:e}=window.graphData||{};if(!e)return null;const o={coding:"Coding",chatbot:"Chatbot",workflow:"Workflow",design:"Design",data:"Data",research:"Research",background:"Background",browser:"Browser",computer:"Computer"}[t.replace("agent-","")];return o&&e[o]?e[o]:null}function showTaskTooltip(t,e,o){const n=getTaskDetails(t);if(!n)return;showTooltipAt(`\n        <div class="tooltip-title">${n.name}</div>\n        <div class="tooltip-content">\n            <div class="tooltip-item"><strong>æ—¶é•¿å æ¯”ï¼š</strong>${n.timePercent}%</div>\n            <div class="tooltip-item"><strong>æ‰€å±åœºæ™¯ï¼š</strong>${n.scene} - ${n.subcat}</div>\n            <div class="tooltip-item"><strong>Agentç±»å‹ï¼š</strong>${n.agent}</div>\n            <div class="tooltip-item"><strong>ä»»åŠ¡ç¤ºä¾‹ï¼š</strong>${n.example}</div>\n            ${n.products.length>0?`<div class="tooltip-item"><strong>ä¸šç•Œäº§å“ï¼š</strong>${n.products.join(", ")}</div>`:""}\n        </div>\n    `,e,o)}function showSubcatTooltip(t,e,o){const n=getSubcatDetails(t);if(!n)return;showTooltipAt(`\n        <div class="tooltip-title">${n.name}</div>\n        <div class="tooltip-content">\n            <div class="tooltip-item"><strong>æ—¶é•¿å æ¯”ï¼š</strong>${n.timePercent}%</div>\n            <div class="tooltip-item"><strong>æ‰€å±åœºæ™¯ï¼š</strong>${n.scene}</div>\n            <div class="tooltip-item"><strong>ä»»åŠ¡æ•°é‡ï¼š</strong>${n.taskCount}ä¸ª</div>\n        </div>\n    `,e,o)}function showSceneTooltip(t,e,o){const n=getSceneDetails(t);if(!n)return;showTooltipAt(`\n        <div class="tooltip-title">${n.name}</div>\n        <div class="tooltip-content">\n            <div class="tooltip-item"><strong>æ—¶é•¿å æ¯”ï¼š</strong>${n.timePercent}%</div>\n            <div class="tooltip-item"><strong>å­ç±»æ•°é‡ï¼š</strong>${n.subcatCount}ä¸ª</div>\n            <div class="tooltip-item"><strong>ä»»åŠ¡æ•°é‡ï¼š</strong>${n.taskCount}ä¸ª</div>\n        </div>\n    `,e,o)}function showAgentTooltip(t,e,o){const n=getAgentDetails(t);if(!n)return;showTooltipAt(`\n        <div class="tooltip-title">${n.icon} ${n.name}</div>\n        <div class="tooltip-content">\n            <div class="tooltip-item"><strong>è¦†ç›–æ—¶é•¿ï¼š</strong>${n.coverage}%</div>\n            <div class="tooltip-item"><strong>æ ¸å¿ƒæŠ€æœ¯ï¼š</strong>${n.techs.join(", ")}</div>\n        </div>\n    `,e,o)}function showTooltipAt(t,e,o){tooltip&&(tooltip.innerHTML=t,tooltip.classList.add("visible"),positionTooltip(e,o))}function positionTooltip(t,e){if(!tooltip)return;const o=15,n=tooltip.getBoundingClientRect(),s=window.innerWidth,i=window.innerHeight;let a=t+o,r=e+o;a+n.width>s-o&&(a=t-n.width-o),r+n.height>i-o&&(r=e-n.height-o),a<o&&(a=o),r<o&&(r=o),tooltip.style.left=`${a}px`,tooltip.style.top=`${r}px`}function hideTooltip(){tooltip&&tooltip.classList.remove("visible")}const moveTooltip=throttle((t,e)=>{positionTooltip(t,e)},16);function initEventListeners(){const t=document.getElementById("network-container");t&&(t.addEventListener("click",t=>{const e=t.target.closest(".collapse-btn");if(e){t.preventDefault(),t.stopPropagation();return void toggleCollapse(e.getAttribute("data-target"),e)}if(t.target.closest(".product-link-area")||t.target.closest(".node-text-link"))return;const o=t.target.closest(".graph-node");if(o){const e=o.getAttribute("data-id");if("product"===o.getAttribute("data-type"))return t.preventDefault(),t.stopPropagation(),void(currentHighlightedId===e?resetHighlight():highlightRelated(e));currentHighlightedId===e?resetHighlight():highlightRelated(e)}else resetHighlight()}),t.addEventListener("mouseover",t=>{const e=t.target.closest(".graph-node");if(e){const t=e.getAttribute("data-id"),o=e.getAttribute("data-type"),n=e.getAttribute("data-url"),s=e.getBoundingClientRect(),i=s.right,a=s.top;switch(o){case"scene":showSceneTooltip(t,i,a);break;case"subcat":showSubcatTooltip(t,i,a);break;case"task":showTaskTooltip(t,i,a);break;case"agent":showAgentTooltip(t,i,a);break;case"product":showProductTooltip(t,n,i,a)}}}),t.addEventListener("mousemove",t=>{tooltip&&tooltip.classList.contains("visible")&&moveTooltip(t.clientX,t.clientY)}),t.addEventListener("mouseout",t=>{const e=t.target.closest(".graph-node"),o=t.relatedTarget;!e||o&&o.closest(".graph-node")||hideTooltip()}))}function showProductTooltip(t,e,o,n){const s=t.replace("product-","").replace(/-/g," "),{taskData:i}=window.graphData||{},a=[],r=new Set;if(i)for(const t of Object.values(i))for(const[e,o]of Object.entries(t.subcategories))for(const n of o.tasks){n.products.some(t=>t.toLowerCase().replace(/\s+/g,"")===s.toLowerCase().replace(/\s+/g,"")||t.toLowerCase().includes(s.toLowerCase())||s.toLowerCase().includes(t.toLowerCase()))&&(a.push({name:n.name,scene:t.name,subcat:e}),r.add(n.agent))}const l=Array.from(r).join(", ")||"æœªçŸ¥",c=a.length>0?a.slice(0,5).map(t=>t.name).join(", ")+(a.length>5?"...":""):"æœªçŸ¥";showTooltipAt(`\n        <div class="tooltip-title">ğŸ”— ${s}</div>\n        <div class="tooltip-content">\n            <div class="tooltip-item"><strong>ç‚¹å‡»æ–‡å­—ï¼š</strong>è·³è½¬äº§å“å®˜ç½‘</div>\n            <div class="tooltip-item"><strong>ç‚¹å‡»èƒŒæ™¯ï¼š</strong>æ˜¾ç¤ºå…³è”å…³ç³»</div>\n            <div class="tooltip-item" style="margin-top: 8px;"><strong>å…³è”Agentï¼š</strong>${l}</div>\n            <div class="tooltip-item"><strong>å…³è”ä»»åŠ¡ï¼š</strong>${c}</div>\n            ${e?`<div class="tooltip-item tooltip-url" style="margin-top: 6px;">${e}</div>`:""}\n        </div>\n    `,o,n)}function initMutationObserver(){const t=document.getElementById("network-container");if(!t)return;new MutationObserver(t=>{clearCache()}).observe(t,{childList:!0,subtree:!0})}function initScrollAnimations(){const t=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.style.opacity="1",t.target.style.transform="translateY(0)")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".stat-card").forEach(e=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition="opacity 0.5s ease, transform 0.5s ease",t.observe(e)}),document.querySelectorAll(".priority-card").forEach((e,o)=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition=`opacity 0.5s ease ${.1*o}s, transform 0.5s ease ${.1*o}s`,t.observe(e)}),document.querySelectorAll(".agent-card").forEach((e,o)=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition=`opacity 0.5s ease ${.05*o}s, transform 0.5s ease ${.05*o}s`,t.observe(e)})}function initProductLinks(){const{productLinks:t}=window.graphData||{};if(!t)return;document.querySelectorAll(".data-table tbody").forEach(e=>{e.querySelectorAll("tr").forEach(e=>{const o=e.querySelectorAll("td");if(o.length>0){const e=o[o.length-1],n=e.textContent.trim().split(",").map(t=>t.trim()).filter(t=>t);if(n.length>0){const o=n.map(e=>{const o=t[e];return o?`<a href="${o}" target="_blank" rel="noopener noreferrer" class="product-link">${e}</a>`:e});e.innerHTML=o.join(", ")}}})})}document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{initEventListeners(),initMutationObserver(),initScrollAnimations(),initProductLinks()},100)}),window.addEventListener("resize",throttle(()=>{clearCache()},250));